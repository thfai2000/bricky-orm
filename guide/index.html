<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>Introduction | Taichi ORM</title><meta name="description" content="A developer-friendly SQL ORM">
    <link rel="preload" href="/taichi-orm/assets/js/runtime~app.2e4b9ea4.js" as="script"><link rel="preload" href="/taichi-orm/assets/css/styles.9e1eec30.css" as="style"><link rel="preload" href="/taichi-orm/assets/js/812.bbad6e40.js" as="script"><link rel="preload" href="/taichi-orm/assets/js/app.d70b86ca.js" as="script">
    <link rel="stylesheet" href="/taichi-orm/assets/css/styles.9e1eec30.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/taichi-orm/" class=""><!----><span class="site-name">Taichi ORM</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a aria-current="page" href="/taichi-orm/guide/" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/thfai2000/taichi-orm" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a aria-current="page" href="/taichi-orm/guide/" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/thfai2000/taichi-orm" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a aria-current="page" href="/taichi-orm/guide/" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-heading sidebar-item active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a><ul class=""><li><!--[--><a aria-current="page" href="/taichi-orm/guide/" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/taichi-orm/guide/#computeproperty" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ComputeProperty"><!--[--><!--]--> ComputeProperty <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/taichi-orm/guide/#why-taichi" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Why TaiChi?"><!--[--><!--]--> Why TaiChi? <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/taichi-orm/guide/#retrieve-relations-by-single-sql-statement" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Retrieve relations by single SQL statement"><!--[--><!--]--> Retrieve relations by single SQL statement <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/taichi-orm/guide/#better-control-on-relation-records" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Better control on relation records"><!--[--><!--]--> Better control on relation records <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/taichi-orm/guide/#more-adaptive-on-changes-of-the-business-requirements" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="More Adaptive on changes of the business Requirements"><!--[--><!--]--> More Adaptive on changes of the business Requirements <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/taichi-orm/guide/getting-started.html" class="nav-link sidebar-item" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><p class="sidebar-item">Concepts</p><ul class="sidebar-sub-items"><li><!--[--><a href="/taichi-orm/guide/concepts/orm.html" class="nav-link sidebar-item" aria-label="ORM"><!--[--><!--]--> ORM <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/database-context.html" class="nav-link sidebar-item" aria-label="DatabaseContext"><!--[--><!--]--> DatabaseContext <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/schema.html" class="nav-link sidebar-item" aria-label="Schema"><!--[--><!--]--> Schema <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/model.html" class="nav-link sidebar-item" aria-label="Model"><!--[--><!--]--> Model <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/property.html" class="nav-link sidebar-item" aria-label="Property"><!--[--><!--]--> Property <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/property-type.html" class="nav-link sidebar-item" aria-label="PropertyType"><!--[--><!--]--> PropertyType <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/relations.html" class="nav-link sidebar-item" aria-label="Relations"><!--[--><!--]--> Relations <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/model-api.html" class="nav-link sidebar-item" aria-label="Model API"><!--[--><!--]--> Model API <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/concepts/query-builder.html" class="nav-link sidebar-item" aria-label="Query Builder"><!--[--><!--]--> Query Builder <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><p class="sidebar-item">Query Examples</p><ul class="sidebar-sub-items"><li><!--[--><a href="/taichi-orm/guide/query-examples/filtering.html" class="nav-link sidebar-item" aria-label="Select and Filter"><!--[--><!--]--> Select and Filter <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/query-examples/operators.html" class="nav-link sidebar-item" aria-label="Operators"><!--[--><!--]--> Operators <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/taichi-orm/guide/typescript-support.html" class="nav-link sidebar-item" aria-label="Typescript Support"><!--[--><!--]--> Typescript Support <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><p class="sidebar-item">Use Cases</p><ul class="sidebar-sub-items"><li><!--[--><a href="/taichi-orm/guide/use-cases/scalar-transform.html" class="nav-link sidebar-item" aria-label="Scalar Transformation"><!--[--><!--]--> Scalar Transformation <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/guide/use-cases/access-control.html" class="nav-link sidebar-item" aria-label="Access Control"><!--[--><!--]--> Access Control <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--[--><a href="/taichi-orm/reference/" class="nav-link sidebar-heading sidebar-item" aria-label="Reference"><!--[--><!--]--> Reference <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/taichi-orm/reference/scalar.md" class="nav-link sidebar-item" aria-label="/reference/scalar.md"><!--[--><!--]--> /reference/scalar.md <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/taichi-orm/reference/config.md" class="nav-link sidebar-item" aria-label="/reference/config.md"><!--[--><!--]--> /reference/config.md <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h1><p>A new way to deal with your Data Logic of SQL Databse. You can define a virtual field called <code>ComputeProperty</code> (that actually is SQL statement) for a data model.</p><ul><li>The common data logics in form of <code>ComputeProperty</code> of Data Model become more reusable.</li><li>The codes of data query become more human readable because complex data logics can be abstracted in <code>ComputeProperty</code>.</li><li>Simlple but flexible Model API. Without using <code>QueryBuilder</code>, <code>Model API</code> is powerful enough to build complex logics by extending or modifying the <code>ComputeProperty</code>.</li><li>Developed in <strong>Typescript</strong> but you can use it without typescript compiler.</li><li>Common relation logics such as <code>HasMany</code> and <code>belongsTo</code> are can be defined in form of <code>ComputeProperty</code>. And the related Models are queried in one single Sql call.</li></ul><p>In below sections, We will explain the ORM stuff using E-commerce-like database as an example.</p><h2 id="computeproperty" tabindex="-1"><a class="header-anchor" href="#computeproperty" aria-hidden="true">#</a> ComputeProperty</h2><p>Imagine an E-commerce system. A product (Model) has various fields like <code>availableStart</code>, <code>availableEnd</code> and <code>remainingStock</code>. See below code.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>

    <span class="token comment">//define field properties here</span>
    id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>PrimaryKeyType<span class="token punctuation">)</span>
    availableStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>DateNotNullType<span class="token punctuation">)</span>
    availableEnd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>DateNotNullType<span class="token punctuation">)</span>
    remainingStock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>NumberNotNullType<span class="token punctuation">)</span>

    <span class="token comment">//define ComputeProperty based on the value of FieldProperty</span>
    isActive <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Scalar<span class="token operator">&lt;</span>BooleanNotNull<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>$<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span>
            parent<span class="token punctuation">.</span>$<span class="token punctuation">.</span>availableStart<span class="token punctuation">.</span><span class="token function">lessThan</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
            parent<span class="token punctuation">.</span>$<span class="token punctuation">.</span>availableEnd<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
            parent<span class="token punctuation">.</span>$<span class="token punctuation">.</span>remainingStock<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>We define the schema with a <code>isActive</code> ComputeProperty which combines the values of other <code>FieldProperty</code>. It means a product is active when the current time are within these dates and the remainingStock are not zero.</p><p>That <code>ComputeProperty</code> consists of <code>ComputeFunction</code> that defines how to make a SQL value (we called <code>Scalar</code>). The variable <code>parent</code> represents the Datasource of <code>Product</code> Model. The <code>FieldProperty</code> can be accessible through the <code>parent</code> variables.</p><p>After the schema is defined, we can query the records like this:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> activeProducts <span class="token operator">=</span> <span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token operator">:</span> <span class="token punctuation">{</span>
    isActive<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Above is the <code>ModelRepository.find()</code> function that accepts one argument <code>FindOptions</code> (Just like the other ORM). The <code>where</code> part specifies the data filtering condition. You can use the <code>isActive</code> ComputeProperty simply just like a normal field in the <code>where</code> object.</p><p>Besides, <code>ComputeFunction</code> can accept argument. Below variable <code>spare</code> is the argument. The argument of <code>ComputeFunction</code> must be optional.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// &#39;Enough&#39; means at least certain amount of stock</span>
  hasEnoughStock <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> spare<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token operator">:</span> CFReturn<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parent<span class="token punctuation">.</span>remainingStock<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span>spare<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Then you can use the <code>ComputeFunction</code> with passing an argument:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">//use ComputeFunction argument</span>
<span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">where</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>root<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> root<span class="token punctuation">.</span><span class="token function">hasEnoughStock</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">//at least 5 remainings</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Or use it like a normal field:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token operator">:</span> <span class="token punctuation">{</span>
    hasEnoughStock<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If you use it as object Key, the argument of that <code>ComputeFunction</code> will be given as undefined.</p></div><h2 id="why-taichi" tabindex="-1"><a class="header-anchor" href="#why-taichi" aria-hidden="true">#</a> Why TaiChi?</h2><h3 id="retrieve-relations-by-single-sql-statement" tabindex="-1"><a class="header-anchor" href="#retrieve-relations-by-single-sql-statement" aria-hidden="true">#</a> Retrieve relations by single SQL statement</h3><p>For some traditional ORM, querying the relation data of Model is not efficient. If the data query consist of multiple Entity, it executes SQL SELECT statement one by one. Usually, it produce several SQL query. But Why can&#39;t we query all these data from database in just one single call.</p><p>Let&#39;s say we have data models <code>Shop</code>, <code>Product</code>, <code>Color</code>. A shop has many products and each product has many colors. For traditional ORM, when we select Entity and its relation like this.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> shops <span class="token operator">=</span> <span class="token keyword">await</span> Shop<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string">&#39;products.colors&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>It generates several SQL statements</p><div class="language-sql ext-sql"><pre class="language-sql"><code>   <span class="token keyword">Select</span> id <span class="token keyword">FROM</span> shop<span class="token punctuation">;</span>  
   <span class="token comment"># result: 1, 2, 3</span>

   <span class="token keyword">Select</span> id <span class="token keyword">FROM</span> Product <span class="token keyword">where</span> shopId <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment"># result: 1, 2, 3, 4, 5</span>

   <span class="token keyword">Select</span> id <span class="token keyword">FROM</span> Color <span class="token keyword">where</span> productId <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment"># result: 1, 2</span>
</code></pre></div><p>But actually we can query the data in only one SQL statement instead:</p><div class="language-sql ext-sql"><pre class="language-sql"><code>  <span class="token keyword">SELECT</span> shop<span class="token punctuation">.</span>id<span class="token punctuation">,</span> 
    <span class="token punctuation">(</span><span class="token keyword">SELECT</span> JSON_ARRAYAGG<span class="token punctuation">(</span>JSON_Array<span class="token punctuation">(</span>id<span class="token punctuation">,</span> colors<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">FROM</span>
        <span class="token punctuation">(</span>
          <span class="token keyword">SELECT</span> product<span class="token punctuation">.</span>id<span class="token punctuation">,</span> 
            <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>same way<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> colors
          <span class="token keyword">FROM</span> product <span class="token keyword">WHERE</span> product<span class="token punctuation">.</span>id <span class="token operator">=</span> shop<span class="token punctuation">.</span>id
        <span class="token punctuation">)</span> <span class="token keyword">AS</span> t
    <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">`</span>products<span class="token punctuation">`</span> 
  <span class="token keyword">FROM</span> shop<span class="token punctuation">;</span>

</code></pre></div><p>The trick is using the SQL server build-in function to construct JSON objects. It may be more efficient than the traditional way. taichi-orm is currently using this approach.</p><h3 id="better-control-on-relation-records" tabindex="-1"><a class="header-anchor" href="#better-control-on-relation-records" aria-hidden="true">#</a> Better control on relation records</h3><p>For some traditional ORM, it is not easy to apply filters on the pivot table of <code>manyToMany</code> relationship&quot; because the Model definition is abstracted. But our Model API allows us applying additional where clause during query. See below code examples.</p><p>Models:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>PrimaryKeyType<span class="token punctuation">)</span>
  <span class="token comment">//possible values: &#39;red&#39;, &#39;blue&#39;...</span>
  code <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringNotNullType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>length<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>
  id<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>PrimaryKeyType<span class="token punctuation">)</span>
  <span class="token comment">//One Product has many Colors</span>
  colors <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">hasManyThrough</span><span class="token punctuation">(</span>
      ProductColor<span class="token punctuation">,</span> Color<span class="token punctuation">,</span> <span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;colorId&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;productId&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// it represents the pivot table</span>
<span class="token comment">// there is a column &#39;type&#39; which means the color type of the product</span>
<span class="token keyword">class</span> <span class="token class-name">ProductColor</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">{</span>
  id<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>PrimaryKeyType<span class="token punctuation">)</span>
  colorId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>NumberNotNullType<span class="token punctuation">)</span>
  productId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>NumberNotNullType<span class="token punctuation">)</span>
  <span class="token comment">//possible values: &#39;main&#39;, &#39;minor&#39;</span>
  type <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringNotNullType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>length<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Query example 1: Select all Products with the filtered Colors that are in red and is the main color of that product.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  select<span class="token operator">:</span> <span class="token punctuation">{</span>
    colors<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// root is Color table, through is pivot table</span>
      <span class="token function-variable function">where</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>root<span class="token punctuation">,</span> through<span class="token punctuation">,</span> And<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">And</span><span class="token punctuation">(</span>
        root<span class="token punctuation">.</span>code<span class="token operator">:</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>     <span class="token comment">// Color.code = &#39;red&#39;</span>
        through<span class="token punctuation">.</span>type<span class="token operator">:</span> <span class="token string">&#39;main&#39;</span>  <span class="token comment">// ProductColor.type = &#39;main&#39;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Query example 2: Select any Products which have Colors that are in red and is the main color of that product.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  select<span class="token operator">:</span> <span class="token punctuation">{</span>
    colors<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// root is Product table</span>
  <span class="token function-variable function">where</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>root<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> root<span class="token punctuation">.</span><span class="token function">colors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// root is Color table, through is pivot table</span>
    <span class="token function-variable function">where</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>root<span class="token punctuation">,</span> through<span class="token punctuation">,</span> And<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">And</span><span class="token punctuation">(</span>
      root<span class="token punctuation">.</span>code<span class="token operator">:</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>     <span class="token comment">// Color.code = &#39;red&#39;</span>
      through<span class="token punctuation">.</span>type<span class="token operator">:</span> <span class="token string">&#39;main&#39;</span>  <span class="token comment">// ProductColor.type = &#39;main&#39;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="more-adaptive-on-changes-of-the-business-requirements" tabindex="-1"><a class="header-anchor" href="#more-adaptive-on-changes-of-the-business-requirements" aria-hidden="true">#</a> More Adaptive on changes of the business Requirements</h3><p>traditionally, when building a system , it starts from simple requirement, usually the simple Object API of ORM can cater most of the use case. But when the requirements changes, you may find that only sql query builder or native sql can fulfill your businesss needs, so you have to rewrite the data logics from code from Model API to query builder.</p><p>One of the typical cases is a e-shop app. In early stage, your product page simply lists out the products by product creation date in ascending order (with pagination). As a developer, we usually use the Object API to cater that. But later the product owner ask you to list products by more complex logics like “Order By price of the products but Order By promotion date of the products if today is that promotion date”.</p><p>The traditional Model API cannot cater this because the FindOption accepts array of field names only, we need raw SQL to achieve this requirement.</p><p>But Taichi Model API is more adaptive, in this case, you just need to modify the OrderBy of the FindOption.</p><p>Before:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    orderBy<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span>
    limit<span class="token operator">:</span> <span class="token number">50</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>After:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token function-variable function">orderBy</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>root<span class="token punctuation">,</span> If<span class="token punctuation">,</span> Now<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span> 
        value<span class="token operator">:</span> <span class="token function">If</span><span class="token punctuation">(</span> 
          root<span class="token punctuation">.</span>promotionDate<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Now<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
          root<span class="token punctuation">.</span>price     
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        order<span class="token operator">:</span> <span class="token string">&#39;asc&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    limit<span class="token operator">:</span> <span class="token number">50</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/thfai2000/taichi-orm/edit/main/guide/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">12/5/2021, 4:10:02 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: thfai2000@gmail.com">Eddie Tang</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: eddie.tang@scmp.com">Eddie Tang</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/taichi-orm/reference/" class="nav-link" aria-label="Reference"><!--[--><!--]--> Reference <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/taichi-orm/assets/js/runtime~app.2e4b9ea4.js" defer></script><script src="/taichi-orm/assets/js/812.bbad6e40.js" defer></script><script src="/taichi-orm/assets/js/app.d70b86ca.js" defer></script>
  </body>
</html>
